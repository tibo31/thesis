library(knitr)
knitr::opts_chunk$set(echo = TRUE)
opts_chunk$set(fig.align = "center",
cache = F,
fig.width = 7,
fig.height = 6,
cache.lazy = FALSE
)
options(kableExtra.latex.load_packages = FALSE)
library(compositions)
world_iso_3 <- merge(world, outflows, by = "iso3")
world_iso_3 <- merge(world_iso_3, inflows, by = "iso3")
A <- c(0, 0)
B <- c(1, 0)
C <- c(0.5, sqrt(3) / 2)
# identify countries influenced by one composition
# out
ind_belize <- 25
ind_saudi <- 177
ind_viet <- which(world_iso_3$SOVRN == "Viet Nam")
temp_out <- world_iso_3[c(ind_belize, ind_saudi, ind_viet), ]
ind_chad <- which(world_iso_3$SOVRN == "Chad")
ind_cuba <- which(world_iso_3$SOVRN == "Cuba")
ind_lebanon <- which(world_iso_3$SOVRN == "Lebanon")
temp_in <- world_iso_3[c(ind_lebanon, ind_cuba, ind_chad), ]
temp_compo <- st_drop_geometry(world_iso_3)
# merge spatial data
for(s in c("out", "in")) {
s_3 <- temp_compo[, paste0(s, "_", c("outwards", "returns", "transit"))] /
temp_compo[, paste0(s, "_total")]
s_3[s_3 == 0] <- 0.01
acomp_s3 <- compositions::acomp(s_3)
names(acomp_s3) <- c("outwards", "returns", "transit")
n <- nrow(s_3)
s_3_mean <- acomp_s3[1, ] / n
for(k in 2:nrow(acomp_s3))
s_3_mean <- s_3_mean + acomp_s3[k, ] / n
s_3_centered <- as(acomp_s3, "matrix")
Y_simplex_x <- s_3_centered[, 1] * A[1] + s_3_centered[, 2] * B[1] +
s_3_centered[, 3] * C[1]
Y_simplex_y <- s_3_centered[, 1] * A[2] + s_3_centered[, 2] * B[2] +
s_3_centered[, 3] * C[2]
pdf(paste0("figures/coda_colors_", s , ".pdf"),
width = 13 * 0.8, height = 4.35 * 0.8)
par(oma = c(0, 0, 0, 0), mfrow = c(1, 2))
par(mar = c(0, 0, 0.3, 0))
pal_col_ternary <- tricolore::Tricolore(data.frame(
outwards = c(0.7, 0.6, 0.4, 0.25, 0.05, 0.5, 0.25, 0.05, 0.25),
returns = c(0.25, 0.25, 0.25, 0.25, 0.25, 0.45, 0.45, 0.45, 0.7),
transit = c(0.05, 0.15, 0.35, 0.5, 0.7, 0.05, 0.2, 0.5, 0.05)),
'outwards', 'returns', 'transit',
hue = 0.2, breaks = 3)$rgb
list_poly <- list(
list(x = c(0, 1/3, 1/6, 0),
y = c(0, 0, C[2] / 3, 0)),
list(x = c(1/6, 1/3, 1/2, 1/6),
y = c(C[2]/3, 0, C[2]/3, C[2]/3)),
list(x = c(1/3, 2/3, 1/2, 1/3),
y = c(0, 0, C[2]/3, 0)),
list(x = c(1/2, 2/3, 5/6, 1/2),
y = c(C[2]/3, 0, C[2]/3, C[2]/3)),
list(x = c(2/3, 1, 5/6, 2/3),
y = c(0, 0, C[2]/3, 0)),
list(x = c(1/6, 1/2, 1/3, 1/6),
y = c(C[2]/3, C[2]/3, 2*C[2]/3, C[2]/3)),
list(x = c(1/3, 1/2, 2/3, 1/3),
y = c(2*C[2]/3, C[2]/3, 2*C[2]/3, 2*C[2]/3)),
list(x = c(1/2, 5/6, 2/3, 1/2),
y = c(C[2]/3, C[2]/3, 2 * C[2]/3, C[2]/3)),
list(x = c(1/3, 2/3, 1/2, 1/3),
y = c(2 * C[2]/3, 2 * C[2]/3,  C[2], 2 * C[2]/3))
)
plot(rbind(A, B, C), xaxt = "n", yaxt = "n", frame = F,
type = "n", xlab = "", ylab = "", asp = 1, main = "",
ylim = c(-0.12, sqrt(3)/2), cex.main = 2)
for(l in 1:9) {
polygon(list_poly[[l]]$x, list_poly[[l]]$y, col = pal_col_ternary[l],
border = NULL, lty = 1, lwd = 0.1)
}
points(Y_simplex_x, Y_simplex_y, col = "black",
cex = 0.4, pch = 16)
if(s == "out") {
points(Y_simplex_x[c(ind_belize, ind_saudi, ind_viet)],
Y_simplex_y[c(ind_belize, ind_saudi, ind_viet)],
col = "red",
cex = 0.6, pch = 16)
} else {
points(Y_simplex_x[c(ind_lebanon, ind_cuba, ind_chad)],
Y_simplex_y[c(ind_lebanon, ind_cuba, ind_chad)],
col = "red",
cex = 0.6, pch = 16)
}
text(c(0.04, 0.96, 1/2 - 0.1), c(0-0.12, -0.12, sqrt(3)/2 - 0.041),
c("Outward", "Return", "Transit"), pos = 3,
cex = 1, col = pal_col_ternary[c(1, 5, 9)])
lines(c(0, 1), c(0, 0), col = "black")
lines(c(0, 0.5), c(0, sqrt(3)/2), col = "black")
lines(c(1, 0.5), c(0, sqrt(3)/2), col = "black")
mtext(paste0("\t \t \t Compositions of ", s, "flows"),
side = 2, line = -2, cex = 1.1)
# XR lines
my_labels <- c("1/3", "2/3")
for (k in 1:2) {
text(1-k/6, k/3 * C[2], my_labels[k], pos = 4, cex = 0.7,
col = pal_col_ternary[c(9)])
}
# Left lines
for (k in 1:2) {
text(k/3, 0, my_labels[k], pos = 1, cex = 0.7, srt = 250,
col = pal_col_ternary[c(5)])
}
# Right lines
for (k in 1:2) {
text(k * 1 / 6-0.01, k/3 * C[2], rev(my_labels)[k], pos = 3, cex = 0.7, srt = 135,
col = pal_col_ternary[c(1)])
}
new_col <-  tricolore::Tricolore(as(acomp_s3, "data.frame"),
'outwards', 'transit','returns',
hue = 0.2, breaks = 3)$rgb
#####################################.
par(mar = c(0, 0, 0, 0))
plot(sea, col = "lightblue", border = rgb(0.2, 0.2, 0.2))
plot(long_sf, add = T, col = "lightgrey")
plot(lat_sf, add = T, col = "lightgrey")
plot(st_geometry(world_iso_3),  border = new_col,
lwd = 0.2,
col = new_col, add = T)
if(s == "out") {
plot(st_geometry(temp_out),
border = "red",
col = pal_col_ternary[c(9, 5, 1)],
lwd = 0.5, add = T)
text(st_coordinates(st_centroid(temp_out))[, 1],
st_coordinates(st_centroid(temp_out))[, 2],
temp_out$SOVRN, pos = 4, cex = 0.5)
} else {
plot(st_geometry(temp_in),
border = "red",
col = pal_col_ternary[c(9, 5, 1)],
lwd = 0.5, add = T)
text(st_coordinates(st_centroid(temp_in))[, 1],
st_coordinates(st_centroid(temp_in))[, 2],
temp_in$SOVRN, pos = 4, cex = 0.5)
}
dev.off()
}
